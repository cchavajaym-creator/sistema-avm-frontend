<div class="w-full">
    <div class="p-6 w-full">
        <!-- Header -->
        <div class="flex items-start justify-between gap-4">
            <div class="flex items-center gap-3 flex-wrap">
                <mat-icon class="icon-size-6 text-secondary" [svgIcon]="'heroicons_outline:briefcase'"></mat-icon>
                <div class="text-2xl font-semibold leading-tight">
                    {{ proyecto?.nombreProyecto || 'Proyecto' }}
                </div>
                <app-tag *ngIf="proyectoFinalizado()" label="Proyecto finalizado" color="warn" />
            </div>
            <a mat-stroked-button [color]="'primary'" [routerLink]="['./editar']" [state]="{ proyecto: proyecto }">
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:pencil-square'"></mat-icon>
                <span class="ml-2">Editar</span>
            </a>
        </div>

        <!-- Meta tags -->
        <div class="mt-3 flex flex-wrap gap-2">
            <app-tag *ngIf="proyecto?.proyectoId" [label]="'ID: ' + proyecto?.proyectoId" color="gray" variant="outline" />
            <div class="text-secondary flex items-center gap-2">
                <span>Estado:</span>
                <app-tag *ngIf="proyecto?.estado as e"
                         [label]="(e.nombre || e.descripcion) | titlecase"
                         [color]="estadoColor(e?.descripcion || e?.nombre)" />
            </div>
        </div>

        <mat-divider class="my-4"></mat-divider>

        <!-- Body -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="md:col-span-2">
                <div class="font-medium mb-1">Descripción</div>
                <div class="text-secondary whitespace-pre-line">{{ proyecto?.descripcion || '—' }}</div>
            </div>

            <div>
                <div class="font-medium mb-1">Fechas</div>
                <div class="space-y-2">
                    <div class="flex items-center gap-2">
                        <mat-icon class="icon-size-5 text-secondary" [svgIcon]="'heroicons_outline:calendar-days'"></mat-icon>
                        <span>Inicio: {{ proyecto?.fechaInicio | date:'longDate' }}</span>
                        <app-tag [label]="dateTagLabel(proyecto?.fechaInicio)" [color]="dateTagColor(proyecto?.fechaInicio)" />
                    </div>
                    <div class="flex items-center gap-2">
                        <mat-icon class="icon-size-5 text-secondary" [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                        <span>Fin: {{ proyecto?.fechaFin | date:'longDate' }}</span>
                        <app-tag *ngIf="proyecto?.fechaFin"
                                 [label]="dateTagLabel(proyecto?.fechaFin)"
                                 [color]="dateTagColor(proyecto?.fechaFin)" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen y Gráficas -->
        <mat-divider class="my-6"></mat-divider>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Actividades: Donut realizadas/pendientes -->
            <div class="bg-card p-4 rounded shadow-sm">
                <apx-chart
                    [series]="actSeries"
                    [chart]="actChart"
                    [labels]="actLabels"
                    [legend]="actLegend"
                    [responsive]="actResponsive"
                    [dataLabels]="actDataLabels"
                    [title]="actTitle"
                    [stroke]="actStroke"
                ></apx-chart>
                <div class="mt-2 text-sm text-secondary">
                    Total: {{ resumen?.actividades?.total || 0 }}
                    · Realizadas: {{ resumen?.actividades?.realizadas || 0 }}
                    · Pendientes: {{ resumen?.actividades?.pendientes || 0 }}
                </div>
            </div>

            <!-- Beneficiarios: Pie activos/inactivos -->
            <div class="bg-card p-4 rounded shadow-sm">
                <apx-chart
                    [series]="benfSeries"
                    [chart]="benfChart"
                    [labels]="benfLabels"
                    [legend]="benfLegend"
                    [responsive]="benfResponsive"
                    [dataLabels]="benfDataLabels"
                    [title]="benfTitle"
                ></apx-chart>
                <div class="mt-2 text-sm text-secondary">
                    Total: {{ resumen?.beneficiarios?.total || 0 }}
                    · Activos: {{ resumen?.beneficiarios?.activos || 0 }}
                    · Inactivos: {{ (resumen?.beneficiarios?.total || 0) - (resumen?.beneficiarios?.activos || 0) }}
                </div>
            </div>

            <!-- Beneficios: tarjetas de resumen -->
            <div class="grid grid-cols-1 gap-4">
                <div class="bg-card p-4 rounded shadow-sm">
                    <div class="text-sm text-secondary">Entregas de beneficios</div>
                    <div class="text-2xl font-semibold">{{ resumen?.beneficios?.entregasTotal || 0 }}</div>
                </div>
                <div class="bg-card p-4 rounded shadow-sm">
                    <div class="text-sm text-secondary">Beneficios distintos</div>
                    <div class="text-2xl font-semibold">{{ resumen?.beneficios?.beneficiosDistintos || 0 }}</div>
                </div>
                <div class="bg-card p-4 rounded shadow-sm">
                    <div class="text-sm text-secondary">Cantidad total entregada</div>
                    <div class="text-2xl font-semibold">{{ resumen?.beneficios?.cantidadTotal || 0 }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
