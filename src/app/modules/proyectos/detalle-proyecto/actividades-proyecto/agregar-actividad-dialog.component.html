<div class="p-6 w-full">
  <div class="flex items-center justify-between mb-2">
    <div class="flex items-center justify-center">
        <mat-icon
            [svgIcon]="'heroicons_outline:check-circle'"
        ></mat-icon>
        <span class="ml-2 font-semibold">{{ editMode ? 'Editar actividad' : 'Agregar actividad' }}</span>
    </div>
    <button mat-icon-button (click)="cerrar()">
      <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
    </button>
  </div>

   <mat-divider class="mb-8 mt-6"></mat-divider>

  <form [formGroup]="form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <mat-form-field class="md:col-span-2" appearance="outline">
      <mat-label>Nombre de la actividad</mat-label>
      <input matInput formControlName="nombreActividad" />
    </mat-form-field>

    <mat-form-field appearance="outline" class="md:col-span-2">
      <mat-label>Tipo de actividad</mat-label>
      <mat-select formControlName="tipoActividad">
        <mat-option *ngFor="let t of tiposActividad" [value]="t.value">{{ t.label }}</mat-option>
      </mat-select>
      <mat-hint>
        <app-tag *ngIf="form.get('tipoActividad')?.value as t"
                 [label]="t | titlecase"
                 [color]="tipoColor(t)" />
      </mat-hint>
    </mat-form-field>

    <!-- Fecha de la actividad (estilo pill con datepicker oculto) -->
    <div class="md:col-span-2">
        <div class="font-medium">Fecha de la actividad</div>
        <div
            class="relative mt-1.5 flex cursor-pointer items-center rounded-full px-4 leading-9"
            [ngClass]="{
                'bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-300':
                    !fechaActividad,
                'bg-green-200 text-green-800 dark:bg-green-500 dark:text-green-100':
                    fechaActividad && !isOverdue(),
                'bg-red-200 text-red-800 dark:bg-red-500 dark:text-red-100':
                    fechaActividad && isOverdue(),
            }"
            (click)="dueDatePicker.open()"
        >
            <mat-icon
                class="text-current icon-size-5"
                [svgIcon]="'heroicons_solid:calendar'"
            ></mat-icon>
            <span class="ml-2 text-md font-medium">
                @if (fechaActividad) {
                    {{ fechaActividad | date: 'longDate' }}
                }
                @if (!fechaActividad) {
                    Sin fecha
                }
            </span>
            <mat-form-field
                class="fuse-mat-dense pointer-events-none invisible absolute inset-0 -mt-2.5 opacity-0"
                [subscriptSizing]="'dynamic'"
            >
                <input
                    matInput
                    [formControlName]="'fechaActividad'"
                    [matDatepicker]="dueDatePicker"
                    [min]="minDate"
                />
                <mat-datepicker #dueDatePicker>
                    <mat-datepicker-actions>
                        <button
                            mat-button
                            (click)="form.get('fechaActividad')?.setValue(null)"
                            matDatepickerCancel
                        >
                            Limpiar
                        </button>
                        <button
                            class=""
                            mat-flat-button
                            [color]="'primary'"
                            matDatepickerApply
                        >
                            Seleccionar
                        </button>
                    </mat-datepicker-actions>
                </mat-datepicker>
            </mat-form-field>
        </div>
    </div>

    <mat-form-field class="md:col-span-2" appearance="outline">
      <mat-label>Descripci√≥n</mat-label>
      <textarea matInput rows="3" formControlName="descripcion"></textarea>
    </mat-form-field>

    <mat-form-field class="md:col-span-2" appearance="outline">
      <mat-label>Lugar</mat-label>
      <input matInput formControlName="lugar" />
    </mat-form-field>
  </form>

  <div class="mt-4 flex justify-end gap-2">
    <button mat-stroked-button color="warn" (click)="cerrar()">Cancelar</button>
    <button mat-flat-button color="primary" (click)="guardar()" [disabled]="enviando || form.invalid">Guardar</button>
  </div>
</div>
