<div class="flex flex-col gap-4 p-4 w-full">
  <div class="flex items-center justify-between">
    <h2 class="text-xl font-semibold">Reporte de Beneficiarios</h2>
    <div class="flex gap-2">
      <!--<button mat-flat-button color="primary" (click)="exportarCSV()">
        <mat-icon>download</mat-icon>
        <span class="ml-2">Exportar CSV</span>
      </button>-->
      <button mat-stroked-button color="primary" (click)="exportarXLSX()">
        <mat-icon>download</mat-icon>
        <span class="ml-2">Exportar XLSX</span>
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-6 items-center gap-4">
    <div class="flex flex-col gap-2">
      <mat-form-field appearance="outline">
        <mat-label>Departamento</mat-label>
        <mat-select [value]="departamentoId()" (selectionChange)="setDepartamento($event.value)">
          <mat-option [value]="null">Todos</mat-option>
          <mat-option *ngFor="let d of departamentos" [value]="d.departamentoId">{{ d.nombreDepartamento }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="flex flex-col gap-2">
      <mat-form-field appearance="outline">
        <mat-label>Municipio</mat-label>
        <mat-select [disabled]="!departamentoId()" [value]="municipioId()" (selectionChange)="setMunicipio($event.value)">
          <mat-option [value]="null">Todos</mat-option>
          <mat-option *ngFor="let m of municipios" [value]="m.municipioId">{{ m.nombreMunicipio }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <mat-form-field appearance="outline">
      <mat-label>Mayor de edad</mat-label>
      <mat-select [value]="mayorEdad()" (selectionChange)="setMayorEdad($event.value)">
        <mat-option [value]="null">Todos</mat-option>
        <mat-option [value]="true">Sí</mat-option>
        <mat-option [value]="false">No</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Estado beneficiario</mat-label>
      <mat-select [value]="estadoBeneficiario()" (selectionChange)="setEstadoBeneficiario($event.value)">
        <mat-option [value]="null">Todos</mat-option>
        <mat-option [value]="1">Activo</mat-option>
        <mat-option [value]="2">Inactivo</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Buscar</mat-label>
      <input matInput placeholder="Nombre, municipio o departamento" [value]="buscar()" (input)="setBuscar($any($event.target).value)" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <div class="flex gap-2 items-center pb-4">
        <button mat-flat-button color="primary" (click)="aplicarFiltros()">
            <mat-icon>search</mat-icon>
            <span class="ml-2">Buscar</span>
        </button>

        <button mat-stroked-button (click)="limpiarFiltros()">
            <mat-icon>filter_alt_off</mat-icon>
            <span class="ml-2">Limpiar</span>
        </button>

    </div>



  </div>

  <div class="overflow-auto rounded border border-gray-200">
    <table mat-table [dataSource]="filtrados()" class="w-full" matSort (matSortChange)="onSortChange($event)">
      <ng-container matColumnDef="nombreCompleto">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="nombreCompleto">Nombre</th>
        <td mat-cell *matCellDef="let row">{{ row.nombreCompleto }}</td>
      </ng-container>

      <ng-container matColumnDef="genero">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="genero">Género</th>
        <td mat-cell *matCellDef="let row">{{ generoLabel(row.genero) }}</td>
      </ng-container>

      <ng-container matColumnDef="nombreDepartamento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="nombreDepartamento">Departamento</th>
        <td mat-cell *matCellDef="let row">{{ row.nombreDepartamento }}</td>
      </ng-container>

      <ng-container matColumnDef="nombreMunicipio">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="nombreMunicipio">Municipio</th>
        <td mat-cell *matCellDef="let row">{{ row.nombreMunicipio }}</td>
      </ng-container>

      <ng-container matColumnDef="estadoBeneficiario">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="estadoBeneficiario">Estado</th>
        <td mat-cell *matCellDef="let row">
          <estado-chip [estado]="row.estadoBeneficiario"></estado-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="fechaInicio">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="fechaInicio">Fecha inicio</th>
        <td mat-cell *matCellDef="let row">{{ row.fechaInicio | date: 'yyyy-MM-dd' }}</td>
      </ng-container>

      <ng-container matColumnDef="edad">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="edad">Edad</th>
        <td mat-cell *matCellDef="let row">{{ row.edad || '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="esMayorEdad">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="esMayorEdad">Mayor de edad</th>
        <td mat-cell *matCellDef="let row">{{ row.esMayorEdad ? 'Sí' : 'No' }}</td>
      </ng-container>

      <ng-container matColumnDef="latitud">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="latitud">Latitud</th>
        <td mat-cell *matCellDef="let row">{{ row.latitud }}</td>
      </ng-container>

      <ng-container matColumnDef="longitud">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="longitud">Longitud</th>
        <td mat-cell *matCellDef="let row">{{ row.longitud }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <mat-paginator
    [length]="total()"
    [pageIndex]="page()"
    [pageSize]="pageSize()"
    [pageSizeOptions]="[5, 10, 25, 50]"
    (page)="onPage($event)"
    class="mt-2"
  />
</div>
